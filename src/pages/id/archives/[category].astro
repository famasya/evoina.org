---
import { getCollection, type CollectionEntry } from "astro:content";
import Button from "../../../components/Button.astro";
import PageTitle from "../../../components/PageTitle.astro";
import { getLocaleFromUrl, loadTranslations } from "../../../i18n";
import Layout from "../../../layouts/Layout.astro";

export async function getStaticPaths() {
  // Get all archive entries for Indonesian locale
  const allArchiveEntries = await getCollection("archives", ({ data }) => {
    return data.locale === "id";
  });

  // Get unique categories for Indonesian archives
  const categories = [
    ...new Set(allArchiveEntries.map((entry) => entry.data.category)),
  ];

  return categories.map((category) => ({
    params: { category },
    props: {
      category,
      entries: allArchiveEntries.filter(
        (entry) => entry.data.category === category,
      ),
    },
  }));
}

type Props = {
  category: string;
  entries: CollectionEntry<"archives">[];
};

const { category, entries } = Astro.props;

// Get current locale from URL
const currentLocale = getLocaleFromUrl(Astro.url);
const translations = await loadTranslations(currentLocale);
---

<Layout title={`${category} - Archives`}>
  <PageTitle title={`${category} Archives`} />
  <main class="auto-padding my-6">
    <div class="mb-8">
      <Button
        title={translations.buttons.back_to_archives}
        href="/id/archives"
        extendClass="px-6"
      />
    </div>

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {
        entries.map((entry) => (
          <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
            {entry.data.image && (
              <img
                src={entry.data.image}
                alt={entry.data.title}
                class="w-full h-48 object-cover"
              />
            )}
            <div class="p-6">
              <h2 class="text-xl font-semibold mb-2">{entry.data.title}</h2>
              <p class="text-gray-600 mb-4">{entry.data.description}</p>
              <div class="flex justify-between items-center text-sm text-gray-500">
                <span>{entry.data.pubDate.toLocaleDateString("id-ID")}</span>
                <a
                  href={`/id/post/${entry.slug.split("/").pop()}`}
                  class="text-blue-600 hover:text-blue-800 font-medium"
                >
                  {translations.buttons.read_more}
                </a>
              </div>
            </div>
          </article>
        ))
      }
    </div>
  </main>
</Layout>
