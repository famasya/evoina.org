---
const researchActivities = [
  {
    title: "Kingdom Plantae",
    description:
      "Penelitian evolusi tumbuhan Indonesia, termasuk adaptasi ekologi dan diversifikasi spesies endemik di berbagai habitat tropis.",
    image: "/carousels/Cuora_amboinensis_NurHerjayanti.JPG",
  },
  {
    title: "Kingdom Animalia",
    description:
      "Studi komprehensif evolusi fauna Indonesia, dari mamalia hingga invertebrata, dengan fokus pada endemisme dan biogeografi.",
    image: "/carousels/Haeromys_minahasae_HeruHandika.jpg",
  },
  {
    title: "Kingdom Fungi",
    description:
      "Eksplorasi keanekaragaman jamur tropis Indonesia dan perannya dalam ekosistem, termasuk simbiosis dan dekomposisi.",
    image: "/carousels/Tylomelania_ArifMaulana.JPG",
  },
  {
    title: "Ekologi Evolusioner",
    description:
      "Penelitian interaksi antara organisme dan lingkungan dalam konteks evolusi, termasuk adaptasi terhadap perubahan iklim.",
    image: "/carousels/Graphium_NurHerjayanti.JPG",
  },
  {
    title: "Genomik Komparatif",
    description:
      "Analisis genom untuk memahami sejarah evolusi dan hubungan filogenetik spesies Indonesia menggunakan teknologi modern.",
    image: "/carousels/Rhyticeros_cassidix_NurHerjayanti.JPG",
  },
];

// Add client-side JavaScript for carousel functionality
const carouselScript = `
function setupCarousel() {
  const carousel = document.querySelector('.carousel-container');
  if (!carousel) return;

  const prevBtn = document.querySelector('.carousel-prev');
  const nextBtn = document.querySelector('.carousel-next');
  const items = document.querySelectorAll('.carousel-item');
  
  if (items.length === 0) {
    if(prevBtn) prevBtn.style.display = 'none';
    if(nextBtn) nextBtn.style.display = 'none';
    return;
  }

  let itemWidth = 0;
  let currentIndex = 0;
  let visibleItems = window.innerWidth < 768 ? 1 : 3;

  carousel.style.scrollBehavior = 'smooth';

  function updateButtons() {
    if (!prevBtn || !nextBtn) return;
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex >= items.length - visibleItems;
  }

  function scrollToItem(index) {
    const isMobile = window.innerWidth < 768;
    const gap = isMobile ? 16 : 32; // Corresponds to gap-4 and md:gap-8
    if (items.length > 0 && items[0]) {
      itemWidth = items[0].offsetWidth + gap;
    }
    const targetScroll = index * itemWidth;
    carousel.scrollLeft = targetScroll;
  }

  function handlePrevClick() {
    if (currentIndex > 0) {
      currentIndex--;
      scrollToItem(currentIndex);
      updateButtons();
    }
  }

  function handleNextClick() {
    if (currentIndex < items.length - visibleItems) {
      currentIndex++;
      scrollToItem(currentIndex);
      updateButtons();
    }
  }

  if (prevBtn) prevBtn.addEventListener('click', handlePrevClick);
  if (nextBtn) nextBtn.addEventListener('click', handleNextClick);

  let resizeTimer;
  const handleResize = () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      const newVisibleItems = window.innerWidth < 768 ? 1 : 3;
      if (newVisibleItems !== visibleItems) {
        visibleItems = newVisibleItems;
        currentIndex = 0; // Reset on breakpoint change
      }
      scrollToItem(currentIndex);
      updateButtons();
    }, 250);
  };

  window.addEventListener('resize', handleResize);
  
  // Initial setup
  scrollToItem(currentIndex);
  updateButtons();

  function cleanup() {
    if (prevBtn) prevBtn.removeEventListener('click', handlePrevClick);
    if (nextBtn) nextBtn.removeEventListener('click', handleNextClick);
    window.removeEventListener('resize', handleResize);
    document.removeEventListener('astro:before-swap', cleanup);
  }

  document.addEventListener('astro:before-swap', cleanup);
}

document.addEventListener('astro:page-load', setupCarousel);
`;
---

<div class="m-16">
  <div class="flex flex-row items-center justify-center gap-8">
    <h2 class="font-serif text-3xl mb-4 bg-eggshell-500 px-4 py-1">
      Kegiatan Penelitian
    </h2>
  </div>

  <div class="relative w-full">
    <div
      class="carousel-container flex overflow-x-hidden scrollbar-hide snap-x snap-mandatory gap-4 md:gap-8 py-4 px-2 w-full"
    >
      {
        researchActivities.map((activity, index) => (
          <div class="carousel-item flex-shrink-0 w-11/12 sm:w-96 px-2 snap-center">
            <div class="flex flex-col gap-4 border border-eggshell-400 hover:border-eggshell-300 p-4 rounded-xl h-full bg-gradient-to-b from-eggshell-600 to-eggshell-500">
              <div class="flex flex-row items-center gap-4">
                <img
                  src={activity.image}
                  class="h-24 w-24 object-cover rounded-full"
                  alt={activity.title}
                  loading="lazy"
                />
                <div>
                  <h3 class="font-serif text-xl">{activity.title}</h3>
                  <p class="text-base">{activity.description}</p>
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>

    <div
      class="flex flex-row items-center justify-center md:justify-end gap-3 mt-4 px-4"
    >
      <button
        class="carousel-prev px-4 py-2 rounded-full bg-eggshell-600 hover:bg-eggshell-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm md:text-base"
      >
        ← Sebelumnya
      </button>
      <button
        class="carousel-next px-4 py-2 rounded-full bg-eggshell-600 hover:bg-eggshell-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm md:text-base"
      >
        Selanjutnya →
      </button>
    </div>
  </div>

  {/* Add custom styles for the carousel */}
  <style>
    /* Responsive carousel styles */
    .carousel-container {
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
      scroll-behavior: smooth;
      transition: scroll-left 0.3s ease-in-out;
      -webkit-overflow-scrolling: touch; /* For smooth scrolling on iOS */
      padding: 0 0.5rem; /* Add horizontal padding on mobile */

      /* Mobile styles */
      @media (max-width: 767px) {
        padding: 0 0.25rem;
      }
    }
    .carousel-container::-webkit-scrollbar {
      display: none; /* Chrome, Safari and Opera */
    }
    .snap-x {
      scroll-snap-type: x mandatory; /* Enable snap scrolling */
    }
    .snap-center {
      scroll-snap-align: center; /* Enable snap alignment */
    }

    /* Mobile optimizations */
    @media (max-width: 767px) {
      .carousel-item {
        width: calc(100% - 1rem) !important; /* Full width minus padding */
        margin: 0 0.5rem; /* Add some spacing between items */
      }

      /* Adjust text sizes for mobile */
      .carousel-item h3 {
        font-size: 1.1rem;
        line-height: 1.2;
      }

      .carousel-item p {
        font-size: 0.9rem;
        line-height: 1.3;
      }
    }
  </style>

  {/* Add the carousel script */}
  <script is:inline set:html={carouselScript} />
</div>
